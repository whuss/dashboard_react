import pytest
from datetime import date

from utils.date import date_range, parse_date

# ----------------------------------------------------------------------------------------------------------------------


parse_date_data = [("2020-03-23", date(2020, 3, 23)),
                   ("2019-12-31", date(2019, 12, 31))]

# ----------------------------------------------------------------------------------------------------------------------


@pytest.mark.parametrize("input_str, result_date", parse_date_data)
def test_parse_date(input_str, result_date):
    assert parse_date(input_str) == result_date

# ----------------------------------------------------------------------------------------------------------------------


parse_date_invalid_data = ["2020-01-40", "test", "1999/12/23"]

# ----------------------------------------------------------------------------------------------------------------------


@pytest.mark.parametrize("input_str", parse_date_invalid_data)
def test_parse_date_invalid(input_str):
    with pytest.raises(ValueError):
        parse_date(input_str)

# ----------------------------------------------------------------------------------------------------------------------


d = parse_date
data_range_data = [(d("2020-03-12"),
                    d("2020-03-15"),
                    [d("2020-03-12"), d("2020-03-13"), d("2020-03-14")]),
                   (d("2019-12-30"),
                    d("2020-01-02"),
                    [d("2019-12-30"), d("2019-12-31"), d("2020-01-01")]),
                   (d("2019-12-30"),
                    d("2015-01-01"),
                    []),
                   (d("2019-10-30"),
                    d("2019-10-30"),
                    [])
                   ]

# ----------------------------------------------------------------------------------------------------------------------


@pytest.mark.parametrize("a, b, interval", data_range_data)
def test_date_range(a, b, interval):
    assert list(date_range(a, b)) == interval

# ----------------------------------------------------------------------------------------------------------------------

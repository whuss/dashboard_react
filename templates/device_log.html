{% extends 'layout.html' %}

{% block head %}
{% endblock %}

{% block body %}
<div id="content">
<h1>Show logs</h1>
<span>Device:</span>
<div class="btn-group">
    <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">{{request.view_args.device}}</button>
    <div class="dropdown-menu">
        {% for device in devices %}
            <a class="dropdown-item" href="{{url_for_self(device=device)}}">{{device}}</a>
        {% endfor %}
    </div>
</div>
<span>Logging level:</span>
<div class="btn-group">
    <button type="button" class="btn btn-light dropdown-toggle" data-toggle="dropdown">
        <span class="{{request.view_args.log_level|or_else("TRACE")}}">{{request.view_args.log_level|or_else("TRACE")}}</span>
    </button>
    <div class="dropdown-menu">
        <a class="dropdown-item TRACE" href="{{url_for_self(log_level='TRACE')}}">TRACE</a>
        <a class="dropdown-item DEBUG" href="{{url_for_self(log_level='DEBUG')}}">DEBUG</a>
        <a class="dropdown-item INFO" href="{{url_for_self(log_level='INFO')}}">INFO</a>
        <a class="dropdown-item WARNING" href="{{url_for_self(log_level='WARNING')}}">WARNING</a>
        <a class="dropdown-item ERROR" href="{{url_for_self(log_level='ERROR')}}">ERROR</a>
        <a class="dropdown-item CRITICAL" href="{{url_for_self(log_level='CRITICAL')}}">CRITICAL</a>
    </div>
</div>
        <span>At time:</span>
        <span id="reportrange" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc; width: 100%">
        <i class="fa fa-calendar"></i>&nbsp;
        <span>{{request.view_args.timestamp}}</span> <i class="fa fa-caret-down"></i>
        </span>
</div>
<div id="terminal">
    <pre>{{log_text|safe}}</pre>
</div>
{% endblock %}

{% block script %}
<script>
$(function() {
    var timestamp = "{{request.view_args.timestamp }}";

    function cb(start, end) {
        $('#reportrange span').html(start.format('MMMM D, YYYY HH:mm'));
    }

    $('#reportrange').daterangepicker({
        singleDatePicker: true,
        timePicker: true,
        timePicker24Hour: true,
        showDropdowns: true,
        minYear: 1901,
        maxYear: parseInt(moment().format('YYYY'), 10)
    }, cb);

    cb(start, end);
});
</script>
{% endblock script %}

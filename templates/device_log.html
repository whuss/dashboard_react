{% extends 'layout.html' %}

{% block head %}
{% endblock %}

{% block body %}
<div id="content">
<h1>Show logs</h1>
<div class="container-fluid toolbar">
<span class="label">Device:</span class="label">
<div class="btn-group">
    <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">{{request.view_args.device}}</button>
    <div class="dropdown-menu">
        {% for device in devices %}
            <a class="dropdown-item" href="{{url_for_self(device=device)}}">{{device}}</a>
        {% endfor %}
    </div>
</div>
<span class="label">Logging level:</span class="label">
<div class="btn-group">
    <button type="button" class="btn btn-light dropdown-toggle" data-toggle="dropdown">
        <span class="{{request.view_args.log_level|or_else("TRACE")}}">{{request.view_args.log_level|or_else("TRACE")}}</span>
    </button>
    <div class="dropdown-menu">
        <a class="dropdown-item TRACE" href="{{url_for_self(log_level='TRACE')}}">TRACE</a>
        <a class="dropdown-item DEBUG" href="{{url_for_self(log_level='DEBUG')}}">DEBUG</a>
        <a class="dropdown-item INFO" href="{{url_for_self(log_level='INFO')}}">INFO</a>
        <a class="dropdown-item WARNING" href="{{url_for_self(log_level='WARNING')}}">WARNING</a>
        <a class="dropdown-item ERROR" href="{{url_for_self(log_level='ERROR')}}">ERROR</a>
        <a class="dropdown-item CRITICAL" href="{{url_for_self(log_level='CRITICAL')}}">CRITICAL</a>
    </div>
</div>
        <span>At time:</span>
        <span id="reportrange" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc; width: 100%">
        <i class="fa fa-calendar"></i>&nbsp;
        <span>{{request.view_args.timestamp|datetime}}</span> <i class="fa fa-caret-down"></i>
        </span>
<span class="label">Duration:</span>
<div class="btn-group">
    <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
       {{request.view_args.duration|or_else(5)|format_duration}}
    </button>
    <div class="dropdown-menu">
        <a class="dropdown-item" href="{{url_for_self(duration=5)}}">5 minutes</a>
        <a class="dropdown-item" href="{{url_for_self(duration=10)}}">10 minutes</a>
        <a class="dropdown-item" href="{{url_for_self(duration=30)}}">30 minutes</a>
        <a class="dropdown-item" href="{{url_for_self(duration=60)}}">1 hour</a>
        <a class="dropdown-item" href="{{url_for_self(duration=12*60)}}">12 hours</a>
        <a class="dropdown-item" href="{{url_for_self(duration=24*60)}}">1 day</a>
    </div>
</div>
</div>
</div>
<div id="terminal">
    <pre>{{log_text|safe}}</pre>
</div>
{% endblock %}

{% block script %}
<script>
$(function() {
    var timestamp = "{{request.view_args.timestamp }}";

    function cb(start, end) {
        $('#reportrange span').html(start.format('YYYY-MM-DD HH:mm:ss'));
        window.location = "{{url_for_self(timestamp=None)}}" + "/" + start.format('YYYY-MM-DD HH:mm:ss');
    }

    $('#reportrange').daterangepicker({
        singleDatePicker: true,
        timePicker: true,
        timePicker24Hour: true,
        showDropdowns: true,
        minYear: 2020,
        maxYear: 2022,
    }, cb);

    cb(start, end);
});
</script>
{% endblock script %}
